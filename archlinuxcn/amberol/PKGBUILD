# Maintainer: Kiri <kiri@vern.cc> 
# Contributor: Igor Dyatlov <dyatlov.igor@protonmail.com>

pkgname=amberol
pkgver=2024.1
pkgrel=1
pkgdesc="Plays music, and nothing else"
arch=(x86_64)
url="https://gitlab.gnome.org/World/amberol"
license=('GPL-3.0-or-later')
depends=(cairo
         dbus
         dconf
         gcc-libs
         gdk-pixbuf2
         glib2
         glibc
         graphene
         gst-plugins-bad-libs
         gst-plugins-base-libs
         gstreamer
         gtk4
         hicolor-icon-theme
         libadwaita
         pango)
makedepends=(cargo
             meson)
checkdepends=(appstream-glib
              desktop-file-utils
              reuse)
_archive="$pkgname-$pkgver"
source=("$_archive.tar.gz::$url/-/archive/$pkgver/$_archive.tar.gz")
options=('!lto')
sha512sums=('1f1bc220036236d9a1a5eee401022fef319b2dc05be1f03c8a67298b6e2f94bc7683f4eb2b676197ff40f0b4774df5cfd0dc33b53a8b25214e7f97b1382d76e4')

prepare() {
  cd $_archive
  export RUSTUP_TOOLCHAIN=stable
  cargo fetch --locked --target "$CARCH-unknown-linux-gnu"
}

build() {
  arch-meson $_archive build --buildtype=release
  meson compile -C build
}

check() {
  meson test -C build --print-errorlogs
}

package() {
  meson install -C build --destdir "$pkgdir"
}
